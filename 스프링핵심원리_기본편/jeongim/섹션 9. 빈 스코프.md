
# 빈(Bean) 스코프
- 스프링 빈은 기본적으로 싱글톤 스코프로 생성됨
- 스코프는 빈이 존재할 수 있는 범위
- 스프링은 다양한 스코프 지원
    - 싱글톤 : 기본 스코프. 스프링 컨테이너의 시작과 종료까지 가장 넓은 범위의 스코프
    - 프로토타입 : 스프링 컨테이너는 프로토타입 빈의 생성과 의존관계 주입까지만 관여하고 더는 관리하지 않는 짧은 범위의 스코프
    - 웹 관련 스코프
        - request : 웹 요청이 들어오고 나갈때까지 유지되는 스코프
        - session : 웹 세션이 생성되고 종료될 때까지 유지되는 스코프
        - application : 웹의 서블릿 컨텍스와 같은 범위로 유지되는 스코프

# 프로토타입 스코프
- 싱글톤 스코프의 빈을 조회하면 스프링 컨테이너는 같은 인스턴스의 스프링 빈을 반환하지만 프로토타입 스코프를 스프링 컨테이너에 조회하면 항상 새로운 인스턴스를 생성해서 반환한다.
- 스프링 컨테이너는 프로토타입 빈을 생성하고, 의존관계 주입, 초기화까지만 처리한다. 따라서, 프로토타입 빈을 관리하는 책임은 클라이언트에 있어서 @PreDestroy 와 같은 종료 메서드가 호출되지 않는다.
- 싱글톤 빈은 스프링 컨테이너가 생성 시점에 초기화 메서드가 실행되지만 프로토타입 스코프의 빈은 스프링 컨테이너에서 빈을 조회할 때 생성되고 초기화 메서드가 실행된다.
- 싱글톤 빈을 함께 사용할 때 문제점 <br>
    ** cmd + opt + n : 인라인으로 코드 수정
    - 스프링은 일반적으로 싱글톤 빈을 사용하므로 싱글톤 빈이 프로토타입 빈을 사용하게 된다. 그런데 싱글톤 빈은 생성 시점에만 의존관계 주입을 받기 때문에 프로토타입 빈이 새로 생성되기는 하지만 싱글톤 빈과 함께 계속 유지되는 것이 문제
- 싱글톤 빈과 함께 사용시 Provider로 문제 해결
    - 지정한 빈을 컨테이너에서 대신 찾아주는 DL 서비스를 제공하는 ObjectProvider 사용
    - 의존관계 탐색(DL-Dependency Lookup) : 의존관계를 외부에서 주입(DI) 받는게 아닌 직접 필요한 의존관계를 찾는 것
- 매번 사용할 때마다 의존관계 주입이 완료된 새로운 객체가 필요할 때는 프로토타입 빈을 사용하면 된다.
- 실무에서 프로토타입 빈을 사용하는 일은 드물다.

# 웹 스코프
- 웹 환경에서만 동작
- 프로토타입과 다르게 스프링이 웹 스코프의 종료시점까지 관리하기 때문에 종료 메서드가 호출된다.
- 종류
    - request : HTTP 요청 하나가 들어오고 나갈 때까지 유지되는 스코프. 각각의 요청마다 별도의 빈 인스턴스가 생성되고 관리됨
    - session : HTTP Session과 동일한 생명주기를 가지는 스코프
    - application : 서블릿 컨텍스트와 동일한 생명주기를 가지는 스코프
    - websocket : 웹 소켓과 동일한 생명주기를 가지는 스코프
- 프록시 방식
    - @Scope 어노테이션 내부에 proxyMode = xxx 추가
        - 적용대상이 클래스이면 proxyMode = ScopedProxyMode.TARGET_CLASS
        - 적용대상이 인터페이스이면 proxyMode = ScopedProxyMode.INTERFACES
    - 이 방식은 가짜 프록시 클래스를 만들어 HTTP Request와 상관없이 가짜 프록시 클래스를 다른 빈에 미리 주입해 둘 수 있다. 
    - 가짜 프록시 객체 요청이 오면 그때 내부에서 진짜 빈을 요청하는 위임 로직을 가지고 있다.
    - 프록시 방식을 사용하면 클라이언트는 마치 싱글톤 빈을 사용하듯 편리하게 request 스코프를 사용할 수 있다.
    - 웹 스코프가 아니어도 프록시를 사용할 수 있다.     



# 정리

### 1. 프록시

- 프록시(Proxy)는 "대리"의 의미로, 인터넷과 관련해서 쓰이는 경우, 특히 내부 네트워크에서 인터넷 접속을 할 때에, 빠른 액세스나 안전한 통신등을 확보하기 위한 중계서버를 "프록시 서버"라고 일컫는다. 클라이언트와 Web서버의 중간에 위치하고 있어, 대신 통신을 받아 주는 것이 프록시 서버
- 참고 : https://engineer-mole.tistory.com/288